<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="renderer" content="webkit">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>index</title>
        <link rel="stylesheet" href="css/reset.css">
        <style>
            body{
                min-height: 1000px;
            }
            .ipt-date,.ipt-date2{
                display: inline-block;
                margin:20px 20px 20px 0;
                width: 100px;
                height: 26px;
                line-height: 26px;
                padding-left: 8px;
                border: 1px solid #333;
                border-radius: 3px;
            }
            .m-date{
                border: 1px solid #eee;
                cursor: default;
                display: none;
                position: absolute;
                width: 170px;
                padding: 8px;
                background-color: #fff;
                border-radius: 2px;
                box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.14), 0 2px 2px 0 rgba(0, 0, 0, 0.098), 0 1px 5px 0 rgba(0, 0, 0, 0.084);
                -moz-user-select:none;
            }
            .m-date_tbl{
                width: 100%;
                text-align: center;
            }
            .m-date_tbl td,.m-date_tbl th{
                height: 24px;
            }
            .m-date_tit{
                text-align: center;
                margin-bottom: 5px;
            }
            .m-date_tit_mar{
                margin: 0 5px;
            }
            .m-date_tit_mar:hover,.m-date_tit_nex-yea:hover,.m-date_tit_pre-yea:hover{
                color: coral;
            }
        </style>
    </head>
    <body>
        <span>开始日：</span>
        <div class="ipt-date j-start">2016-7-4</div>
        <span>结束日：</span>
        <div class="ipt-date2 j-end">2016-7-4</div>
        <div class="m-date" onselectstart="return false">
            <div class="m-date_tit">	
                <span class="m-date_tit_pre-yea">&lt;&lt;</span>
                <span class="m-date_tit_mar m-date_tit_pre-mon">&lt;</span>
                <span class="m-date_tit_year"></span>
                <span>-</span>
                <span class="m-date_tit_month"></span>
                <span class="m-date_tit_mar m-date_tit_nex-mon">&gt;</span>
                <span class="m-date_tit_nex-yea">&gt;&gt;</span>
            </div>
            <div>
                <table class="m-date_tbl">
                    <tr>
                        <th>日</th>
                        <th>一</th>
                        <th>二</th>
                        <th>三</th>
                        <th>四</th>
                        <th>五</th>
                        <th>六</th>
                    </tr>
                    <tr>
                        <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                    </tr>

                </table>
            </div>
        </div>
        <script src="js/jquery-1.12.3.min.js"></script>
        <script>
            $(function(){
                    //初始化开始时间为今天时间
                    var nowYear=parseInt(new Date().getFullYear());
                    var nowMonth=parseInt(new Date().getMonth());
                    var iptYear=nowYear;
                    var iptMonth=nowMonth+1;
                    var iptDay=parseInt(new Date().getDate());
                    $(".j-start").text(iptYear+"-"+iptMonth+"-"+iptDay);
                    //初始化结束时间为今天时间
                    var nowYear2=nowYear;
                    var nowMonth2=nowMonth;
                    var iptYear2=iptYear;
                    var iptMonth2=iptMonth;
                    var iptDay2=iptDay;
                    $(".j-end").text(iptYear2+"-"+iptMonth2+"-"+iptDay2);
                    //点击出现选择框
                    $(".j-start").click(function(){
                        reTbl(nowYear,nowMonth,true);
                        //下个月
                        $(".m-date_tit_nex-mon").unbind().click(function(){
                            nowMonth++;
                            if(nowMonth==12){
                                nowMonth=0;
                                nowYear++;
                            }
                            reTbl(nowYear,nowMonth,true);
                        })
                        //上个月
                        $(".m-date_tit_pre-mon").unbind().click(function(){
                            nowMonth--;
                            if(nowMonth==-1){
                                nowMonth=11;
                                nowYear--;
                            }
                            reTbl(nowYear,nowMonth,true);
                        })
                        //下一年
                        $(".m-date_tit_nex-yea").unbind().click(function(){
                            nowYear++;
                            reTbl(nowYear,nowMonth,true);
                        })
                        //上一年
                        $(".m-date_tit_pre-yea").unbind().click(function(){
                            nowYear--;
                            reTbl(nowYear,nowMonth,true);
                        })
                    })
                    $(".j-end").click(function(){
                        reTbl(nowYear2,nowMonth2,false);
                        //下个月
                        $(".m-date_tit_nex-mon").unbind().click(function(){
                            nowMonth2++;
                            if(nowMonth2==12){
                                nowMonth2=0;
                                nowYear2++;
                            }
                            reTbl(nowYear2,nowMonth2,false);
                        })
                        //上个月
                        $(".m-date_tit_pre-mon").unbind().click(function(){
                            nowMonth2--;
                            if(nowMonth2==-1){
                                nowMonth2=11;
                                nowYear2--;
                            }
                            reTbl(nowYear2,nowMonth2,false);
                        })
                        //下一年
                        $(".m-date_tit_nex-yea").unbind().click(function(){
                            nowYear2++;
                            reTbl(nowYear2,nowMonth2,false);
                        })
                        //上一年
                        $(".m-date_tit_pre-yea").unbind().click(function(){
                            nowYear2--;
                            reTbl(nowYear2,nowMonth2,false);
                        })
                    })
                    $(".j-start,.j-end").click(function(event){
                        var iptTop=$(this).offset().top+$(this).height()+3;
                        var iptLeft=$(this).offset().left;
                        $(".m-date").css({left:iptLeft,top:iptTop+"px",display:"block"});
                        event.stopPropagation();
                    })
                    //阻止m-date事件冒泡
                    $(".m-date").click(function(event){
                        event.stopPropagation();
                    })
                    //点击选择框之外的地方关闭
                    $("body").click(function(){
                        $(".m-date").hide();
                    })
                    //更新表格
                    function reTbl(newYear,newMonth,a){
                        if (a){
                            var iptY=iptYear;
                            var iptM=iptMonth;
                            var iptD=iptDay;
                        }else{
                            var iptY=iptYear2;
                            var iptM=iptMonth2;
                            var iptD=iptDay2;
                        }
                        var newDate=new Date(newYear,newMonth);
                        var oneWeek=parseInt(newDate.getDay());//这月第一天星期几
                        var maxDay=new Date(newYear,newMonth+1,0).getDate();//这月最后一天日期
                        $(".m-date_tbl td").css({backgroundColor:"#fff",color:"#333"});
                        if(iptY==newYear&&iptM==newMonth+1){
                            $(".m-date_tbl td").eq(oneWeek+iptD-1).css({backgroundColor:"coral",color:"#fff"});
                        }
                        $(".m-date_tbl td").text("").unbind();
                        for(var i=0;i<maxDay;i++){
                            $(".m-date_tbl td").eq(oneWeek).text(i+1)//填上日期
                            //添加悬浮高亮
                            .hover(function(){
                                $(this).css({backgroundColor:"coral",color:"#fff"});
                            },
                            function(){
                                if(iptY!==newYear||iptM!==newMonth+1||iptD!==parseInt($(this).text())){
                                    $(this).css({backgroundColor:"#fff",color:"#333"});
                                }
                            })
                            //点击事件
                            .click(function(){
                                if(a){
                                    iptDay=parseInt($(this).text());
                                    iptYear=nowYear;
                                    iptMonth=nowMonth+1;
                                    $(".j-start").text(iptYear+"-"+iptMonth+"-"+iptDay);
                                }else{
                                    iptDay2=parseInt($(this).text());
                                    iptYear2=nowYear2;
                                    iptMonth2=nowMonth2+1;
                                    $(".j-end").text(iptYear2+"-"+iptMonth2+"-"+iptDay2);
                                }
                                $(".m-date").hide();
                            });
                            oneWeek++;
                        }
                        $(".m-date_tit_year").text(newYear);
                        newMonth++;
                        $(".m-date_tit_month").text(newMonth);
                    }
            })
        </script>
    </body>
</html>